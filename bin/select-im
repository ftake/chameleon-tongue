#!/usr/bin/python

import os, sys

locale_dir = "/usr/lib/input-method/locale.d/"
profile_dir = "/usr/lib/input-method/profile.d/"

def get_lang():
    if "LC_ALL" in os.environ:
        return os.environ['LC_ALL']
    elif "LC_CTYPE" in os.environ:
        return os.environ['LC_CTYPE']
    elif "LANG" in os.environ:
        return os.environ['LANG']
    else:
        return "en_US"

def default_engine(lang):
    subdirs = [lang]
    for i in range(len(lang) - 1, -1, -1):
        c = lang[i]
        if c == "@" or c == "." or c == "_":
            subdirs.append(lang[:i])

    for subdir in subdirs:
        subdir_path = os.path.join(locale_dir, subdir)
        if os.path.isdir(subdir_path):
            im_files = os.listdir(subdir_path)
            if len(im_files) > 0:
                im_files.sort()
                return locale_dir + subdir + "/" + im_files[0]
    return profile_dir + "none"

if __name__ == "__main__":
    lang = get_lang()
    print default_engine(lang)
